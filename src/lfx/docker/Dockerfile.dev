# syntax=docker/dockerfile:1
# Development Dockerfile for LFX

FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

ENV TZ=UTC

WORKDIR /app

RUN apt-get update \
    && apt-get upgrade -y \
    && apt-get install -y \
    build-essential \
    curl \
    git \
    vim \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Copy workspace files first
COPY pyproject.toml uv.lock ./
COPY src/lfx /app/src/lfx

# Install LFX with development dependencies using workspace lockfile
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --dev --package lfx

# Set working directory
WORKDIR /app/src/lfx

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Expose any ports that might be needed for development
EXPOSE 8000

# Default to bash for development
CMD ["/bin/bash"]